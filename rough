#def validation(new_fname,new_lname,new_password,new_email,new_mobileno):
   
  
@app.route("/signup",methods=["POST"])
def signup():
    a,b=exe_quer('conn','cursor')
    new_fname=request.form['fname']
    new_lname=request.form['lname']
    new_password=request.form['password']  
    new_email  =request.form['email'] 
    new_mobileno=request.form['mobileno']
        

    if 'new_fname' in request.form and 'new_lname' in request.form and 'new_password' in request.form and  'new_email' in request.form and 'new_mobileno' in request.form and  request.method=="POST" :
        
        b.execute('SELECT * FROM login WHERE fname=%s' ,(new_fname,))
        acc=b.fetchone()
        if acc:
            return "Account already exist!"

        elif not re.match (r'[A-Za-z]+',new_fname):    
            return "First name must contain only characters and numbers",400        
        elif not re.match  (r'[^@]+@[^@]+\.[^@]+',new_email):   
            return "Invalid Email address ",400  
        
        elif not re.match (r'[A-Za-z]+',new_lname):    
            return "First name must contain only characters and numbers",400
        
        elif not re.search(re.compile(r'(\+91)?(-)?\s*?(91)?\s*?(\d{3})-?\s*?(\d{3})-?\s*?(\d{4})'),new_mobileno):    
            return "Mobile no must contain only numbers",400 

        else:
            sq="""INSERT INTO login (fname,lname,password,email,mobileno) 
                        VALUES (%s,%s,%s,%s,%s)"""
                                
            b.execute(sq,(new_fname,new_lname,new_password,new_email,new_mobileno))
            a.commit()
            return "You have successfully registered" ,201         
           
                  
    elif not new_fname  or not new_lname or not new_email or not new_mobileno or not new_password:
        return "pls enter all the details" ,400    
      
      
              
        
@app.route('/signin',methods=["POST","DELETE"])
def signin():
        a,b=exe_quer('conn','cursor')

        
        
        if request.method == 'POST':
            new_email  =request.form['email'] 
            new_password=request.form['password']  
        
            se="""SELECT * FROM login WHERE email=%s AND password=%s"""
            b.execute(se,(new_email,new_password))
            account=b.fetchone()
            a.commit()
            
            if account:
                
                new_email=account['email']
                new_password=account['password']
                return 'Logged in successfully!',202
                
                
            else:
                return "Enter correct email or password ",401

        if request.method=='DELETE': 
            sql_del="""DELETE FROM login WHERE email=%s AND password=%s """ 
            b=b.execute(sql_del,(email,password,))
            a.commit()
            return "The email id: {} and password : {}   has been deleted  successfully!. ".format(email,password),200
        return "Please enter correct email or password ",401    

if __name__=='__main__':
    app.run(debug=True)
